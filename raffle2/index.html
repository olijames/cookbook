<!DOCTYPE html>
<html lang="en">
<head>

  <!-- Basic Page Needs
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta charset="utf-8">
  <title>Cancer Society Raffle</title>
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Mobile Specific Metas
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- FONT
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Engagement|Leckerli+One|Mrs+Sheppards" rel="stylesheet">

  <!-- CSS
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/skeleton.css">

  <!-- Favicon
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="icon" type="image/ico" href="images/favicon.ico">



</head>
<body>

  <!-- Primary Page Layout
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->

  <div class="row">
    <div class="four columns"> <img class="u-max-full-width" src="images/jurica-koletic-314364.jpg"></div>
    <div class="four columns"><img class="u-max-full-width" src="images/roman-kraft-106708.jpg"></div>
    <div class="four columns"><img class="u-max-full-width" src="images/soroush-karimi-250194.jpg"></div>
  </div>
  <div class="black">
    <div class="container ">
      <div class="row">
        <div class="six column logo" style="margin-top: 5%">
           <img class="u-max-full-width" src="images/logo.png">
        </div>
      </div>
      <div class="row">
        <div class="seven column header" >
           <h1>Win Return Flights for Two to Europe</h1>
        </div>
      </div>
      <div class="row big gap">
        <div class="three columns logo" style="margin-top: -5%">
           <img class="u-max-full-width bump" src="images/Price-per-ticket.png">
        </div>
         <div class="three columns offset-by-six columns logo" >
           <img class="u-max-full-width" src="images/sa.png">
        </div>
      </div>
    </div>
  </div>
  <div class="text gap">
    <div class="container only-big">
      <div class="row">
        <div class="tweleve columns columns fade-black" style="margin-top: 25%">
          <h3 class="center">Enter the Draw</h3>

          <form id="details" data-toggle="validator" role="form">
            
            <div class="row">
              <div class="six columns">
                <label for="tickets">Number of Tickets</label>
                <input class="u-full-width" type="number" value="1" id="tickets">
              </div>
              <div class="six columns">
                <label for="tickets">Price</label>
                <h3 id="price"> $10 </h3>
              </div>
              <div class="twelve columns">
                <label for="Name">Your Name</label>
                <input class="u-full-width form-control" type="text" id="Name" required>
                <div class="help-block with-errors"></div>
              </div>
              <div class="six columns">
                <label for="Email">Your email</label>
                <input class="u-full-width form-control" type="email"  id="Email" required>
                <div class="help-block with-errors"></div>
              </div>
              <div class="six columns">
                <label for="Phone">Your Phone Number</label>
                <input class="u-full-width form-control" type="text"  id="Phone" required>
                <div class="help-block with-errors"></div>
              </div>
              <div class="twelve columns">
                <label for="Street">Street Address</label>
                <input class="u-full-width form-control" type="text"  id="Street" required>
                <div class="help-block with-errors"></div>
              </div>
              <div class="six columns">
                <label for="Suburb">Suburb</label>
                <input class="u-full-width form-control" type="text"  id="Suburb" required>
                <div class="help-block with-errors"></div>
              </div>
              <div class="six columns">
                <label for="City">City</label>
                <input class="u-full-width form-control" type="text"  id="City" required>
                <div class="help-block with-errors"></div>
              </div>
            </div>
           
              
            
            <br />
            <h5 id="error-message" class="hide"> Please Complete Every Field </h5>
            <a onClick="details()" class="button-primary u-full-width" type="submit">Next</a>
          </form>

          <div id="payment" class="hide gap spacer">
            <form action="/charge" method="post" id="payment-form">
            <div class="form-row">
            <label for="card-element">
           <h3> Credit or debit card </h3>
            </label>
            <div id="card-element">

            </div>

            <div id="card-errors" role="alert"></div>
            </div>
            <button class="button-primary u-full-width ">Submit Payment</button>
            </form>
            <br>
            


        </div>
                    <div class="error-section hide  ">
                        <h4 class="text-center ">Sorry something went wrong</h4>
                        <p class="text-center " id="errormessage"></p>
                      </div>

                      <div class="pass-section hide  ">
                        <h4 class="text-center ">Thank You</h4>
                        <h4 class="text-center ">Your Order has been processed, you should recieve an email with your ticket numbers shortly.</h4>
                        <h4 class="text-center ">Your Order Token Is:</h4>
                        <h1 class="center " id="tokenmessage"></h1>
                      </div>
                      <div class="loader hide spacer">
                        <h2 class="center">Sending ....</h2>
                      </div>
          </div>
      </div>
    </div>
  </div>
  <div class="row gap big">
    <div class="four columns"> <img class="u-max-full-width" src="images/fredy-martinez-348698.jpg"><img class="u-max-full-width" src="images/soroush-karimi-250194.jpg"></div>
    <div class="four columns terms">
        <h3>Terms and Conditions of Singapore Airlines’ Prize</h3>
        <p><b>2x Economy Class Flights to Europe</b>
        </p><p>
        </p><p><b>1</b> The prize ticket has no commercial value and cannot be sold or converted into cash. 
        </p><p><b>2</b> The Prize is one return Economy Class ticket for the prizewinner and one for a companion for travel to any online Europe destination on the Singapore Airlines network (Amsterdam, Stockholm, Dusseldorf, Rome, Paris, Copenhagen, Frankfurt, Manchester, Munich, Milan, Zurich, London, Barcelona, Moscow, and Istanbul). The companion must accompany the prizewinner on all flights. Flights can depart from Auckland, Wellington (via Canberra) or Christchurch. 
        </p><p><b>3</b> The ticket is valid for travel departing during the period from 01 April 2018 until 31 March 2019. This excludes our peak travel period 10 December 2018 to 31 January 2019. Travel must be completed by 31 March 2019. 
        </p><p><b>4</b> All travel must be booked on Singapore Airlines operated aircraft, codeshare flights are not permitted. Maximum stay is 6 months. 
        </p><p><b>5</b> The ticket is non-transferable, non-reroutable and non-endorsable. Any unused portion must be returned to Singapore Airlines Office in Christchurch for cancellation. 
        </p><p><b>6</b> Singapore Airlines may impose flight embargoes during periods of heavy demand as is required commercially from time to time, without prior notice. 
        </p><p><b>7</b> The issuance of tickets is subject to seat availability. 
        </p><p><b>8</b> The ticket will only be issued if all sectors are confirmed. 
        </p><p><b>9</b> Excess baggage waivers will not be granted. 
        </p><p><b>10</b> Prizewinners are responsible for any government and airport taxes related to their tickets. 
        </p><p><b>11</b> The ticket is not valid for any frequent flyer point accrual or upgrades. 
        </p><p><b>12</b> Once the ticket is issued, requests for changes of passengers’ names and traveling sectors made two working days or less before the date of travel will be subjected to Singapore Airline’s approval and upon approval, a cancellation charge of NZD$75.00 per change will be levied. 
        </p><p><b>13</b> The prizewinner will undertake to pay for any transportation costs to and from departure points, or transfers to and from airports or hotels and personal insurance. Passport, visa and re-entry permit are the responsibility of the prizewinner. 
        </p><p><b>14</b> Economy Class tickets are not upgradeable to Business class unless the winner wishes to do so at their expense. 
        </p><p><b>15</b> Singapore Airlines Stopover package is not eligible for prizewinner bookings. 
        </p>
    </div>
    <div class="four columns"><img class="u-max-full-width" src="images/jarand-lokeland-142660.jpg"><img class="u-max-full-width" src="images/jurica-koletic-314364.jpg"></div>
  </div>
  <div class="row gap small">
    <div class="column terms">
        <h3>Terms and Conditions of Singapore Airlines’ Prize</h3>
        <p><b>2x Economy Class Flights to Europe</b>
        </p><p>
        </p><p><b>1</b> The prize ticket has no commercial value and cannot be sold or converted into cash. 
        </p><p><b>2</b> The Prize is one return Economy Class ticket for the prizewinner and one for a companion for travel to any online Europe destination on the Singapore Airlines network (Amsterdam, Stockholm, Dusseldorf, Rome, Paris, Copenhagen, Frankfurt, Manchester, Munich, Milan, Zurich, London, Barcelona, Moscow, and Istanbul). The companion must accompany the prizewinner on all flights. Flights can depart from Auckland, Wellington (via Canberra) or Christchurch. 
        </p><p><b>3</b> The ticket is valid for travel departing during the period from 01 April 2018 until 31 March 2019. This excludes our peak travel period 10 December 2018 to 31 January 2019. Travel must be completed by 31 March 2019. 
        </p><p><b>4</b> All travel must be booked on Singapore Airlines operated aircraft, codeshare flights are not permitted. Maximum stay is 6 months. 
        </p><p><b>5</b> The ticket is non-transferable, non-reroutable and non-endorsable. Any unused portion must be returned to Singapore Airlines Office in Christchurch for cancellation. 
        </p><p><b>6</b> Singapore Airlines may impose flight embargoes during periods of heavy demand as is required commercially from time to time, without prior notice. 
        </p><p><b>7</b> The issuance of tickets is subject to seat availability. 
        </p><p><b>8</b> The ticket will only be issued if all sectors are confirmed. 
        </p><p><b>9</b> Excess baggage waivers will not be granted. 
        </p><p><b>10</b> Prizewinners are responsible for any government and airport taxes related to their tickets. 
        </p><p><b>11</b> The ticket is not valid for any frequent flyer point accrual or upgrades. 
        </p><p><b>12</b> Once the ticket is issued, requests for changes of passengers’ names and traveling sectors made two working days or less before the date of travel will be subjected to Singapore Airline’s approval and upon approval, a cancellation charge of NZD$75.00 per change will be levied. 
        </p><p><b>13</b> The prizewinner will undertake to pay for any transportation costs to and from departure points, or transfers to and from airports or hotels and personal insurance. Passport, visa and re-entry permit are the responsibility of the prizewinner. 
        </p><p><b>14</b> Economy Class tickets are not upgradeable to Business class unless the winner wishes to do so at their expense. 
        </p><p><b>15</b> Singapore Airlines Stopover package is not eligible for prizewinner bookings. 
        </p>
    </div>
  </div>
  

<!-- End Document
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
</body>
<script src="https://js.stripe.com/v3/"></script>
<script src="https://code.jquery.com/jquery-3.2.1.min.js"
  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
  crossorigin="anonymous"></script>

  <script >
      var token;
      var end = false;


  
  $('#tickets').change(function(){

    var price = $('#tickets').val();

    price = price * 10;

    $('#price').html("$" + price);
  });

  start();

  function loader() {
    $("#details").addClass("hide");
    $("#payment").addClass("hide");
    $(".loader").removeClass("hide");

  }

  function details() {


     
       if( $("#Email").val().length < 1 ||  $("#Phone").val().length < 1 ||  $("#Name").val().length < 1 ||  $("#Street").val().length < 1 ||  $("#City").val().length < 1 ||  $("#Suburb").val().length < 1) {
        
          console.log("fail");
          $("#error-message").removeClass("hide");
      } else {
          senddetails();
          
      }

      
  }

  function senddetails() {

     
      loader();

      email = $("#Email").val();
      name =  $("#Name").val();

      address = $("#Street").val()+ " " +$("#Suburb").val() + " " + $("#City").val();

      $.post( "https://desolate-lowlands-92183.herokuapp.com/recorddetails.json", {"fname": $("#Name").val() , "lname": "Raffle", "email": $("#Email").val(), "street": $("#Street").val(), "suburb": $("#Suburb").val(), "city": $("#City").val(), "postcode": " ", "note": $("#Phone").val(), "note2": $("#goals").val() + " " + $("#classes").val(), "token" : token } )
                  .done(function( data ) {
                      
                      $(".loader").addClass("hide");
                       $("#payment").removeClass("hide");

                  })
                    .fail(function(response) {

                        $("#errormessage").html( 'Error: ' + "We're experiencing some technical difficulties, please try again later" );

                        $(".loader").addClass("hide");
                        $(".error-section").removeClass("hide");
                  
              });
    }

  function start() {
      $.post( "https://desolate-lowlands-92183.herokuapp.com/beginsale.json", {"ip": "raffle" , "location":"nz" } )
                    .done(function( data ) {
                      
                      token = data.token;
                      console.log(token);

                    })
                    .fail(function(response) {

                        $("#errormessage").html( 'Error: ' + "We're experiencing some technical difficulties. please try again later" );
                        $("#details").addClass("hide");
                        $("#payment").addClass("hide");
                        $(".error-section").removeClass("hide");
                  
              });
    }

    function stripesend( stripetoken ) {
      if(end == true){return null;}

      end = true;

       loader();
      
            $.post( "https://desolate-lowlands-92183.herokuapp.com/stripe/raffle.json", {"stripetoken": stripetoken , "name": name, "purchase": $("#tickets").val(), "delivery": "", "address": address, "token":token, "email":email} )
                    .done(function( data ) { console.log( data ); pass(); })
                    .fail(function(data) {
                        console.log(data)
                        $("#errormessage").html( 'Please check your order and try again.\nError: <span>' + data + "</span>");

                        $("#details").addClass("hide");
                        $("#payment").addClass("hide");
                        $("#loader").addClass("hide");
                        $(".error-section").removeClass("hide");
                 
              });
    }

    var stripe = Stripe('pk_live_YP8aPjLeMDjvFy2jTcyTNdHw');
    var elements = stripe.elements();

    // Custom styling can be passed to options when creating an Element.
    var style = {
      base: {
        // Add your base input styles here. For example:
        fontSize: '16px',
        lineHeight: '24px'
      }
    };

    // Create an instance of the card Element
    var card = elements.create('card', {style: style});

    // Add an instance of the card Element into the `card-element` <div>
    card.mount('#card-element');

    var form = document.getElementById('payment-form');
    form.addEventListener('submit', function(event) {
      event.preventDefault();

      stripe.createToken(card).then(function(result) {
        if (result.error) {
          // Inform the user if there was an error
          var errorElement = document.getElementById('card-errors');
          errorElement.textContent = result.error.message;
        } else {
          // Send the token to your server
          stripesend(result.token.id);
        }
      });
    });

    function pass() {
      $("#tokenmessage").html( '#: ' + token.substring(0, 6) );
      $("#payment").addClass("hide");
      $(".loader").addClass("hide");
      $(".pass-section").removeClass("hide");
    }

  </script>

</html>
